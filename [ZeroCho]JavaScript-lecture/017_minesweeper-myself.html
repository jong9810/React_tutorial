<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>지뢰찾기 게임</title>
    <style>
      table {
        border-collapse: collapse;
      }
      td {
        border: 1px solid black;
        width: 50px;
        height: 50px;
        background-color: darkgray;
      }
      td.open {
        background-color: lightgray;
      }
    </style>
  </head>

  <body>
    <script>
      // 변수 선언부
      const { body } = document;
      const mine = 10; // 지뢰 개수
      const width = 10; // 가로 칸
      const height = 8; // 새로 칸
      let flag = mine; // 깃발 개수
      let firstLeft = true; // 첫 번째 좌클릭인지
      let startTime;
      let endTime;

      // 게임판 생성
      const board = [];
      const mineBoard = [];
      const $table = document.createElement('table');
      for (let i = 0; i < height; i++) {
        const $tr = document.createElement('tr');
        const rows = [];
        for (let j = 0; j < width; j++) {
          const $td = document.createElement('td');
          const cells = $td;
          rows.push(cells);
          $tr.append($td);
        }
        board.push(rows);
        $table.append($tr);
      }
      body.append($table);

      // 함수 선언부
      // 칸 중 랜덤한 10칸 뽑아서 지뢰를 설치하는 함수
      function shuffle() {
        const flatBoard = board.flat();
        while (flatBoard.length > width * height - mine) {
          const randomIndex = Math.floor(Math.random() * flatBoard.length);
          mineBoard.push(flatBoard.splice(randomIndex, 1)[0]);
        }
      }
      // 좌클릭시 칸 열어주는 함수
      function openBoard() {
        //
      }
      // 좌클릭시 동작
      function onLeftClick() {
        // 첫 번째 좌클릭이면
        if (firstLeft) {
          firstLeft = false;
          startTime = new Date();
          shuffle();
          mineBoard.forEach((el) => {
            el.className = 'mine';
          });
        }
      }
      // 우클릭시 동작
      function onRightClick() {
        //
      }

      $table.addEventListener('click', onLeftClick);
      $table.addEventListener('click', onRightClick);

      // 자바스크립트의 핵심 : lexical 스코프, 실행 context, 이벤트 루프, promise, prototype
      // lexical 스코프 : 함수를 어디서 호출하는지가 아니라 어디에 선언하였는지에 따라 스코프가 결정됨.
      // 함수를 선언한 시점에 상위 스코프가 결정된다.

      // 호이스팅 : 변수를 선언하고 초기화했을 때 선언 부분이 최상단으로 끌어올려지는 현상.(초기화는 그대로 남아있음.)
      // 함수 표현식 : const say = function(){};
      // 함수 선언식 : function say() {}
      // 화살표 함수 : const say = () => {};

      //
    </script>
  </body>
</html>
